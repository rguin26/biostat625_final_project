---
title: "R Notebook"
output: html_notebook
---
```{r}
data <- read.delim(file = 'clinical.tsv', sep = '\t', header = TRUE)
data[data == "\'--"] <- "NULL"
is.na(data) <- data == "NULL"
data <- data[, colSums(is.na(data)) < nrow(data)]
```


```{r}
names(data)
```


```{r}
data <- subset(data, select = -c(case_id, case_submitter_id))
data <- transform(
  data,
  project_id=as.factor(project_id),
  age_at_index=as.numeric(age_at_index),
  age_is_obfuscated=as.factor(age_is_obfuscated),
  cause_of_death=as.factor(cause_of_death),
  days_to_birth=as.numeric(days_to_birth),
  days_to_death=as.numeric(days_to_death),
  ethnicity=as.factor(ethnicity),
  gender=as.factor(gender),
  race=as.factor(race),
  vital_status=as.factor(vital_status),
  year_of_birth=as.numeric(year_of_birth),
  year_of_death=as.numeric(year_of_death),
  age_at_diagnosis=as.numeric(age_at_diagnosis),
  ajcc_pathologic_stage=as.factor(ajcc_pathologic_stage),
  ajcc_staging_system_edition=as.factor(ajcc_staging_system_edition),
  classification_of_tumor=as.factor(classification_of_tumor),
  days_to_diagnosis=as.numeric(days_to_diagnosis),
  days_to_last_follow_up=as.numeric(days_to_last_follow_up),
  days_to_last_known_disease_status=as.numeric(days_to_last_known_disease_status),
  days_to_recurrence=as.numeric(days_to_recurrence),
  icd_10_code=as.factor(icd_10_code),
  last_known_disease_status=as.factor(last_known_disease_status),
  metastasis_at_diagnosis=as.factor(metastasis_at_diagnosis),
  morphology=as.factor(morphology),
  primary_diagnosis=as.factor(primary_diagnosis),
  prior_malignancy=as.factor(prior_malignancy),
  prior_treatment=as.factor(prior_treatment),
  progression_or_recurrence=as.factor(progression_or_recurrence),
  residual_disease=as.factor(residual_disease),
  site_of_resection_or_biopsy=as.factor(site_of_resection_or_biopsy),
  synchronous_malignancy=as.factor(synchronous_malignancy),
  tissue_or_organ_of_origin=as.factor(tissue_or_organ_of_origin),
  tumor_grade=as.factor(tumor_grade),
  year_of_diagnosis=as.numeric(year_of_diagnosis),
  days_to_treatment_end=as.numeric(days_to_treatment_end),
  days_to_treatment_start=as.numeric(days_to_treatment_start),
  initial_disease_status=as.factor(initial_disease_status),
  therapeutic_agents=as.factor(therapeutic_agents),
  treatment_anatomic_site=as.factor(treatment_anatomic_site),
  treatment_intent_type=as.factor(treatment_intent_type),
  treatment_or_therapy=as.factor(treatment_or_therapy),
  treatment_outcome=as.factor(treatment_outcome),
  treatment_type=as.factor(treatment_type)
  )
#summary(data)
```


```{r}
data[data=="not reported"] <- NA
data[data=="Not Reported"] <- NA
data[data=="unknown"] <- NA
data[data=="Unknown"] <- NA
data[data=="not allowed to collect"] <- NA
summary(data)
```

```{r}
rem <- colSums(is.na(data)) > 1000
```


```{r}
data <- subset(data, select = -c(age_is_obfuscated, cause_of_death, days_to_death, year_of_death, ajcc_pathologic_stage, ajcc_staging_system_edition, classification_of_tumor, days_to_last_known_disease_status, days_to_recurrence, last_known_disease_status, metastasis_at_diagnosis, prior_malignancy, progression_or_recurrence, residual_disease, synchronous_malignancy, tumor_grade, days_to_treatment_end, days_to_treatment_start, initial_disease_status, therapeutic_agents, treatment_anatomic_site, treatment_intent_type, treatment_outcome))

summary(data)
```

```{r}
data2 <- data[!is.na(data$vital_status), ]
library(mice)
data_imp <- mice(data2, m=15, method = "sample", printFlag = FALSE)
```

```{r}
data_subset_rf <- complete(data_imp)
summary(data_subset_rf)
```

```{r}
library(randomForest)
library(caTools)
library(caret)
sample <- sample.split(data_subset_rf$vital_status, SplitRatio = .7)
train_rf <- subset(data_subset_rf, sample == TRUE)
test_rf  <- subset(data_subset_rf, sample == FALSE)
#dim(train_rf)
#dim(test_rf)
train_rf$vital_status <- factor(train_rf$vital_status)
test_rf$vital_status <- factor(test_rf$vital_status)
rf <- randomForest(vital_status ~ ., data=train_rf, na.action = na.omit)
```

```{r}
p1 <- predict(rf, train_rf)
confusionMatrix(p1, train_rf$vital_status)
p2 <- predict(rf, test_rf)
confusionMatrix(p2, test_rf$vital_status)
```